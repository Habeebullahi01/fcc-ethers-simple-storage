const ethers = require("ethers")
const fs = require("fs")
require("dotenv").config()

async function main() {
  // http://127.0.0.1:7545
  const provider = new ethers.providers.JsonRpcProvider(process.env.RPC_URL)
  const wallet = new ethers.Wallet(process.env.PRIVATE_KEY, provider)
  //   const encryptedKey = fs.readFileSync("./.encryptedKey.json", "utf8");
  //   let wallet = new ethers.Wallet.fromEncryptedJsonSync(
  //     encryptedKey,
  //     process.env.PRIVATE_KEY_PASSWORD
  //   );
  //   wallet = await wallet.connect(provider);

  const abi = fs.readFileSync("./SimpleStorage_sol_SimpleStorage.abi", "utf8")
  const binary = fs.readFileSync(
    "./SimpleStorage_sol_SimpleStorage.bin",
    "utf8"
  )

  const contractFactory = new ethers.ContractFactory(abi, binary, wallet)
  const contract = await contractFactory.deploy()
  console.log("Contract deployment underway. Please wait.....")
  const d = await contract.deployTransaction.wait(1)
  console.log(`Contract Address: ${contract.address}`)
  console.log(`${d.confirmations} Block confirmations`)
  const currentFavNum = await contract.retrieve()
  console.log(`Current Favorite Number: ${currentFavNum.toString()}`)
  const txResponse = await contract.store(3)
  const txReceipt = await txResponse.wait(1)
  console.log(`New Fav Num: ${await contract.retrieve()}`)

  //   const nonce = await wallet.getTransactionCount();
  //   const tx = {
  //     nonce: nonce,
  //     gasPrice: 20000000000,
  //     gasLimit: 6721975,
  //     to: null,
  //     value: 0,
  //     data: "0x608060405260405180604001604052806040518060400160405280600681526020017f4861626565620000000000000000000000000000000000000000000000000000815250815260200160038152506001600082015181600001908162000068919062000303565b506020820151816001015550503480156200008257600080fd5b50620003ea565b600081519050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b600060028204905060018216806200010b57607f821691505b602082108103620001215762000120620000c3565b5b50919050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b6000600883026200018b7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff826200014c565b6200019786836200014c565b95508019841693508086168417925050509392505050565b6000819050919050565b6000819050919050565b6000620001e4620001de620001d884620001af565b620001b9565b620001af565b9050919050565b6000819050919050565b6200020083620001c3565b620002186200020f82620001eb565b84845462000159565b825550505050565b600090565b6200022f62000220565b6200023c818484620001f5565b505050565b5b8181101562000264576200025860008262000225565b60018101905062000242565b5050565b601f821115620002b3576200027d8162000127565b62000288846200013c565b8101602085101562000298578190505b620002b0620002a7856200013c565b83018262000241565b50505b505050565b600082821c905092915050565b6000620002d860001984600802620002b8565b1980831691505092915050565b6000620002f38383620002c5565b9150826002028217905092915050565b6200030e8262000089565b67ffffffffffffffff8111156200032a576200032962000094565b5b620003368254620000f2565b6200034382828562000268565b600060209050601f8311600181146200037b576000841562000366578287015190505b620003728582620002e5565b865550620003e2565b601f1984166200038b8662000127565b60005b82811015620003b5578489015182556001820191506020850194506020810190506200038e565b86831015620003d55784890151620003d1601f891682620002c5565b8355505b6001600288020188555050505b505050505050565b610cbc80620003fa6000396000f3fe608060405234801561001057600080fd5b506004361061007d5760003560e01c806377ec2b551161005b57806377ec2b55146100d85780638bab8dd5146100f75780639e7a13ad14610127578063f0150ce5146101585761007d565b80632e64cec1146100825780636057361d146100a05780636f760f41146100bc575b600080fd5b61008a610176565b60405161009791906104b0565b60405180910390f35b6100ba60048036038101906100b5919061050b565b61017f565b005b6100d660048036038101906100d1919061067e565b610189565b005b6100e0610218565b6040516100ee929190610762565b60405180910390f35b610111600480360381019061010c9190610792565b6102b2565b60405161011e91906104b0565b60405180910390f35b610141600480360381019061013c919061050b565b6102e0565b60405161014f929190610762565b60405180910390f35b61016061039c565b60405161016d9190610933565b60405180910390f35b60008054905090565b8060008190555050565b60006040518060400160405280848152602001838152509050600481908060018154018082558091505060019003906000526020600020906002020160009091909190915060008201518160000190816101e39190610b61565b50602082015181600101555050816003846040516102019190610c6f565b908152602001604051809103902081905550505050565b600180600001805461022990610984565b80601f016020809104026020016040519081016040528092919081815260200182805461025590610984565b80156102a25780601f10610277576101008083540402835291602001916102a2565b820191906000526020600020905b81548152906001019060200180831161028557829003601f168201915b5050505050908060010154905082565b6003818051602081018201805184825260208301602085012081835280955050505050506000915090505481565b600481815481106102f057600080fd5b906000526020600020906002020160009150905080600001805461031390610984565b80601f016020809104026020016040519081016040528092919081815260200182805461033f90610984565b801561038c5780601f106103615761010080835404028352916020019161038c565b820191906000526020600020905b81548152906001019060200180831161036f57829003601f168201915b5050505050908060010154905082565b60606004805480602002602001604051908101604052809291908181526020016000905b8282101561048e57838290600052602060002090600202016040518060400160405290816000820180546103f390610984565b80601f016020809104026020016040519081016040528092919081815260200182805461041f90610984565b801561046c5780601f106104415761010080835404028352916020019161046c565b820191906000526020600020905b81548152906001019060200180831161044f57829003601f168201915b50505050508152602001600182015481525050815260200190600101906103c0565b50505050905090565b6000819050919050565b6104aa81610497565b82525050565b60006020820190506104c560008301846104a1565b92915050565b6000604051905090565b600080fd5b600080fd5b6104e881610497565b81146104f357600080fd5b50565b600081359050610505816104df565b92915050565b600060208284031215610521576105206104d5565b5b600061052f848285016104f6565b91505092915050565b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b61058b82610542565b810181811067ffffffffffffffff821117156105aa576105a9610553565b5b80604052505050565b60006105bd6104cb565b90506105c98282610582565b919050565b600067ffffffffffffffff8211156105e9576105e8610553565b5b6105f282610542565b9050602081019050919050565b82818337600083830152505050565b600061062161061c846105ce565b6105b3565b90508281526020810184848401111561063d5761063c61053d565b5b6106488482856105ff565b509392505050565b600082601f83011261066557610664610538565b5b813561067584826020860161060e565b91505092915050565b60008060408385031215610695576106946104d5565b5b600083013567ffffffffffffffff8111156106b3576106b26104da565b5b6106bf85828601610650565b92505060206106d0858286016104f6565b9150509250929050565b600081519050919050565b600082825260208201905092915050565b60005b838110156107145780820151818401526020810190506106f9565b83811115610723576000848401525b50505050565b6000610734826106da565b61073e81856106e5565b935061074e8185602086016106f6565b61075781610542565b840191505092915050565b6000604082019050818103600083015261077c8185610729565b905061078b60208301846104a1565b9392505050565b6000602082840312156107a8576107a76104d5565b5b600082013567ffffffffffffffff8111156107c6576107c56104da565b5b6107d284828501610650565b91505092915050565b600081519050919050565b600082825260208201905092915050565b6000819050602082019050919050565b600082825260208201905092915050565b6000610823826106da565b61082d8185610807565b935061083d8185602086016106f6565b61084681610542565b840191505092915050565b61085a81610497565b82525050565b6000604083016000830151848203600086015261087d8282610818565b91505060208301516108926020860182610851565b508091505092915050565b60006108a98383610860565b905092915050565b6000602082019050919050565b60006108c9826107db565b6108d381856107e6565b9350836020820285016108e5856107f7565b8060005b858110156109215784840389528151610902858261089d565b945061090d836108b1565b925060208a019950506001810190506108e9565b50829750879550505050505092915050565b6000602082019050818103600083015261094d81846108be565b905092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b6000600282049050600182168061099c57607f821691505b6020821081036109af576109ae610955565b5b50919050565b60008190508160005260206000209050919050565b60006020601f8301049050919050565b600082821b905092915050565b600060088302610a177fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff826109da565b610a2186836109da565b95508019841693508086168417925050509392505050565b6000819050919050565b6000610a5e610a59610a5484610497565b610a39565b610497565b9050919050565b6000819050919050565b610a7883610a43565b610a8c610a8482610a65565b8484546109e7565b825550505050565b600090565b610aa1610a94565b610aac818484610a6f565b505050565b5b81811015610ad057610ac5600082610a99565b600181019050610ab2565b5050565b601f821115610b1557610ae6816109b5565b610aef846109ca565b81016020851015610afe578190505b610b12610b0a856109ca565b830182610ab1565b50505b505050565b600082821c905092915050565b6000610b3860001984600802610b1a565b1980831691505092915050565b6000610b518383610b27565b9150826002028217905092915050565b610b6a826106da565b67ffffffffffffffff811115610b8357610b82610553565b5b610b8d8254610984565b610b98828285610ad4565b600060209050601f831160018114610bcb5760008415610bb9578287015190505b610bc38582610b45565b865550610c2b565b601f198416610bd9866109b5565b60005b82811015610c0157848901518255600182019150602085019450602081019050610bdc565b86831015610c1e5784890151610c1a601f891682610b27565b8355505b6001600288020188555050505b505050505050565b600081905092915050565b6000610c49826106da565b610c538185610c33565b9350610c638185602086016106f6565b80840191505092915050565b6000610c7b8284610c3e565b91508190509291505056fea2646970667358221220c788eb2cab8394aee8a8dac4b0d4aa27c300d45df01739842aa57391cc909cad64736f6c634300080f0033",
  //     chainId: 1337,
  //   };
  //   const sentTransaction = await wallet.sendTransaction(tx);
  //   await sentTransaction.wait(1);
  //   console.log(sentTransaction);
}

main()
  .then(() => process.exit(0))
  .catch((error) => {
    console.log(error)
    process.exit(1)
  })
